name: Tailscale macOS 

on:
  workflow_dispatch:

jobs:
  setup-runner:
    runs-on: macos-latest
    timeout-minutes: 360

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Tailscale (macOS)
        run: |
          brew install --cask tailscale
          sudo /Applications/Tailscale.app/Contents/MacOS/Tailscale set --accept-dns=false || true

      - name: Authenticate to Tailscale
        run: |
          sudo tailscale up \
            --authkey="tskey-auth-kSctKbzvcG11CNTRL-KMx1PV6EjK3zNxdkUdqzK3dzDieMHL6h" \
            --hostname="macos-github-runner-$(date +%s)" \
            --ssh

      - name: Show Tailscale status (debug)
        run: sudo tailscale status

      - name: Keep runner alive for 6 hours
        run: |
          echo "macOS runner active through Tailscale SSH..."
          sleep 21600
